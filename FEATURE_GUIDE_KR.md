# πΈ Aegis Tuner Pro - μ‹ κ· κΈ°λ¥ κ°€μ΄λ“

## π“‹ λ©μ°¨
1. [μλ™ νλΌλ―Έν„° λ§¤μΉ­](#1-μλ™-νλΌλ―Έν„°-λ§¤μΉ­)
2. [μ—­λ³€ν™ λ¶„μ„](#2-μ—­λ³€ν™-λ¶„μ„)
3. [κΈ°μ  μƒμ„Έ](#3-κΈ°μ -μƒμ„Έ)

---

## 1. μλ™ νλΌλ―Έν„° λ§¤μΉ­

### π“ κ°μ”
μ›λ³Έ μμ›κ³Ό MIDI ν•©μ„± κ²°κ³Όλ¥Ό λΉ„κµν•΄μ„ **μµμ μ νλΌλ―Έν„°λ¥Ό μλ™μΌλ΅ μ°Ύμ•„μ£Όλ”** κΈ°λ¥μ…λ‹λ‹¤.

### π― λ©μ 
- μλ™μΌλ΅ μ¬λΌμ΄λ”λ¥Ό μ΅°μ •ν•λ” μ‹κ°„ μ μ•½
- μ›λ³Έ μμ›κ³Ό κ°€μ¥ μ μ‚¬ν• MIDIλ¥Ό μƒμ„±ν•λ” μµμ κ°’ νƒμƒ‰
- μ΄λ³΄μλ„ μ „λ¬Έκ°€ μμ¤€μ κ²°κ³Όλ¬Ό νλ“

### π€ μ‚¬μ© λ°©λ²•

1. **Aegis Tuner Pro μ‹¤ν–‰**
   ```bash
   cd /Users/mac/.gemini/antigravity/scratch/aegis_engine
   streamlit run aegis_tuner_pro.py
   ```

2. **μμ› νμΌ μ„ νƒ**
   - μ‚¬μ΄λ“λ°”μ—μ„ κΈ°μ΅΄ νμΌ μ„ νƒ λλ” μ—…λ΅λ“

3. **μλ™ λ§¤μΉ­ μ‹¤ν–‰**
   - μ™Όμ½ μ»¨νΈλ΅¤ ν¨λ„ ν•λ‹¨μ **"π¤– Auto Match"** λ²„νΌ ν΄λ¦­
   - νƒμƒ‰ μ§„ν–‰ (μ•½ 1~2λ¶„ μ†μ”)
   - μµμ κ°’ μλ™ μ μ© λ° ν™”λ©΄ μƒλ΅κ³ μΉ¨

4. **κ²°κ³Ό ν™•μΈ**
   - μ¬λΌμ΄λ”κ°€ μλ™μΌλ΅ μµμ κ°’μΌλ΅ μ„¤μ •λ¨
   - ν”Όμ•„λ…Έλ΅¤κ³Ό μ΄λ²¤νΈ λ΅κ·Έμ—μ„ κ°μ„ λ κ²°κ³Ό ν™•μΈ

### π“ λ™μ‘ μ›λ¦¬

#### Coarse-to-Fine Grid Search
```
1λ‹¨κ³„ (Coarse Search):
β”β”€ confidence_threshold: [0.2, 0.4, 0.6]
β”β”€ min_note_duration_ms: [50, 150, 250]
β””β”€ sustain_ms: [100, 300, 500]
   β†’ μ΄ 27κ° μ΅°ν•© ν…μ¤νΈ

2λ‹¨κ³„ (Fine Search):
β””β”€ 1λ‹¨κ³„ μµμ κ°’ μ£Όλ³€μ„ μ„Έλ°€ν•κ² νƒμƒ‰
   β†’ μ¶”κ°€ 27κ° μ΅°ν•© ν…μ¤νΈ
```

#### μ μ‚¬λ„ μΈ΅μ • λ©”νΈλ¦­
- **Spectral Similarity**: Mel Spectrogram Cosine μ μ‚¬λ„ (40% κ°€μ¤‘μΉ)
- **Chroma Similarity**: ν”ΌμΉ μ»¨ν…μΈ  μ μ‚¬λ„ (60% κ°€μ¤‘μΉ)
- **μµμΆ… μ μ**: 0.0 ~ 1.0 (λ†’μ„μλ΅ μ μ‚¬)

### π’΅ ν
- νƒμƒ‰ μ‹κ°„μ΄ κΈΈλ‹¤λ©΄ μ›λ³Έ μμ›μ„ 30μ΄ μ΄ν•λ΅ νΈμ§‘
- λ³µμ΅ν• μμ›μΌμλ΅ μλ™ λ§¤μΉ­ ν¨κ³Όκ°€ νΌ
- κ²°κ³Όκ°€ λ§μμ— μ• λ“¤λ©΄ μλ™μΌλ΅ λ―Έμ„Έ μ΅°μ • κ°€λ¥

---

## 2. μ—­λ³€ν™ λ¶„μ„

### π“ κ°μ”
**MIDI β†’ ν•©μ„± μμ› β†’ λ‹¤μ‹ MIDIλ΅ λ³€ν™**ν•μ—¬ μ›λ³Έ MIDIμ™€ λΉ„κµν•λ” μ •ν™•λ„ λ¶„μ„ κΈ°λ¥μ…λ‹λ‹¤.

### π― λ©μ 
- Aegis Engineμ MIDI λ³€ν™ μ •ν™•λ„ μΈ΅μ •
- μ–΄λ–¤ νλΌλ―Έν„° μ΅°ν•©μ΄ κ°€μ¥ μ •ν™•ν•μ§€ κ°κ΄€μ  ν‰κ°€
- μ—­λ³€ν™ μ†μ‹¤ λ¶„μ„μ„ ν†µν• μ—”μ§„ κ°μ„  μΈμ‚¬μ΄νΈ

### π€ μ‚¬μ© λ°©λ²•

1. **MIDI μƒμ„±**
   - μ¬λΌμ΄λ”λ¥Ό μ΅°μ •ν•κ±°λ‚ Auto Matchλ΅ MIDI μƒμ„±

2. **μ—­λ³€ν™ λ¶„μ„ μ‹¤ν–‰**
   - μ¤λ””μ¤ λΉ„κµ μ„Ήμ… ν•λ‹¨μ **"π”¬ μ—­λ³€ν™ λ¶„μ„ μ‹¤ν–‰"** λ²„νΌ ν΄λ¦­
   - λ¶„μ„ μ§„ν–‰ (μ•½ 30μ΄~1λ¶„ μ†μ”)

3. **κ²°κ³Ό ν™•μΈ**
   ```
   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   β”‚   μ›λ³Έ λ…ΈνΈ     β”‚  μ—­λ³€ν™ λ…ΈνΈ    β”‚  λ…ΈνΈ μΌμΉμ¨    β”‚
   β”‚      245        β”‚      238        β”‚     94.3%       β”‚
   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   β”‚  ν”ΌμΉ μ •ν™•λ„    β”‚ νƒ€μ΄λ° μ •ν™•λ„   β”‚
   β”‚     96.8%       β”‚     89.2%       β”‚
   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   ```

4. **μ—­λ³€ν™ MIDI λ‹¤μ΄λ΅λ“** (μ„ νƒ)
   - λΉ„κµμ©μΌλ΅ μ—­λ³€ν™λ MIDI νμΌ λ‹¤μ΄λ΅λ“ κ°€λ¥

### π“ λ¶„μ„ μ§€ν‘

| μ§€ν‘ | μ„¤λ… | κ³„μ‚° λ°©μ‹ |
|------|------|-----------|
| **μ›λ³Έ λ…ΈνΈ** | μ›λ³Έ MIDIμ μ΄ λ…ΈνΈ κ°μ | MIDI νμ‹± |
| **μ—­λ³€ν™ λ…ΈνΈ** | μ—­λ³€ν™ ν›„ μƒμ„±λ λ…ΈνΈ κ°μ | MIDI νμ‹± |
| **λ…ΈνΈ μΌμΉμ¨** | μ›λ³Έκ³Ό μ—­λ³€ν™ λ…ΈνΈμ λ§¤μΉ­ λΉ„μ¨ | λ§¤μΉ­λ λ…ΈνΈ / μ „μ²΄ λ…ΈνΈ |
| **ν”ΌμΉ μ •ν™•λ„** | ν”ΌμΉ(μλ†’μ΄) μ •ν™•λ„ | 1 - (ν‰κ·  ν”ΌμΉ μ¤μ°¨ / 12) |
| **νƒ€μ΄λ° μ •ν™•λ„** | λ…ΈνΈ μ‹μ‘ μ‹κ°„ μ •ν™•λ„ | 1 - (ν‰κ·  νƒ€μ΄λ° μ¤μ°¨ / 0.5) |

### π”¬ λ™μ‘ νλ¦„
```
μ›λ³Έ MIDI (User Input)
    β†“
[1] MIDI β†’ WAV ν•©μ„± (FluidSynth)
    β†“
[2] WAV μ €μ¥ (μ„μ‹ νμΌ)
    β†“
[3] WAV β†’ MIDI μ—­λ³€ν™ (Aegis Engine)
    β†“
[4] μ—­λ³€ν™ MIDI μ΄λ²¤νΈ μ¶”μ¶
    β†“
[5] μ›λ³Έ vs μ—­λ³€ν™ λΉ„κµ λ¶„μ„
    β†“
κ²°κ³Ό λ¦¬ν¬νΈ μ¶λ ¥
```

### π’΅ ν•΄μ„ κ°€μ΄λ“

#### λ†’μ€ μ •ν™•λ„ (90% μ΄μƒ)
- β… μ—”μ§„μ΄ ν•΄λ‹Ή μμ›μ„ μ •ν™•ν•κ² λ¶„μ„ν•¨
- β… νλΌλ―Έν„° μ„¤μ •μ΄ μ μ ν•¨
- β… μμ› νΉμ„±μ΄ MIDI λ³€ν™μ— μ ν•©ν•¨

#### μ¤‘κ°„ μ •ν™•λ„ (70~90%)
- β οΈ νλΌλ―Έν„° λ―Έμ„Έ μ΅°μ • ν•„μ”
- β οΈ Auto Matchλ΅ κ°μ„  κ°€λ¥
- β οΈ νΉμ • κµ¬κ°„μ—μ„ λ…Έμ΄μ¦ κ°€λ¥μ„±

#### λ‚®μ€ μ •ν™•λ„ (70% λ―Έλ§)
- β μμ›μ΄ λ„λ¬΄ λ³µμ΅ (ν™”μ, λ‹¤μ„±λ¶€)
- β λ°°κ²½ λ…Έμ΄μ¦ λ§μ
- β Stem Separation λ¨Όμ € κ¶μ¥

---

## 3. κΈ°μ  μƒμ„Έ

### π“ νμΌ κµ¬μ΅°
```
aegis_engine/
β”β”€β”€ aegis_engine_core/
β”‚   β”β”€β”€ auto_matcher.py         # μλ™ νλΌλ―Έν„° λ§¤μΉ­ (NEW)
β”‚   β”β”€β”€ reverse_analyzer.py     # μ—­λ³€ν™ λ¶„μ„ (NEW)
β”‚   β”β”€β”€ synthesizer.py          # FluidSynth MIDIβ†’WAV ν•©μ„±
β”‚   β””β”€β”€ ...
β”β”€β”€ aegis_tuner_pro.py          # Streamlit UI (μμ •λ¨)
β””β”€β”€ test_new_features.py        # ν…μ¤νΈ μ¤ν¬λ¦½νΈ
```

### π”§ auto_matcher.py

#### μ£Όμ” ν•¨μ
```python
def auto_match_parameters(
    original_audio_path,  # μ›λ³Έ μμ› κ²½λ΅
    engine,               # AegisEngine μΈμ¤ν„΄μ¤
    raw_data,             # μΊμ‹λ λ¶„μ„ λ°μ΄ν„°
    sample_rate=44100,
    progress_callback=None
) -> dict
```

#### λ°ν™κ°’
```python
{
    'confidence_threshold': 0.45,    # μµμ  μ‹ λΆ°λ„ μ„κ³„κ°’
    'min_note_duration_ms': 120,     # μµμ  μµμ† λ…ΈνΈ κΈΈμ΄
    'sustain_ms': 280,               # μµμ  μ„μ¤ν…μΈ μ‹κ°„
    'score': 0.847                   # μ μ‚¬λ„ μ μ (0~1)
}
```

#### μµμ ν™” μ „λµ
- **νƒμƒ‰ λ²”μ„ μ ν•**: μ‹¤μ©μ μΈ νλΌλ―Έν„° λ²”μ„λ§ νƒμƒ‰
- **μ΅°κΈ° μΆ…λ£**: λΉ MIDI μƒμ„± μ‹ ν•΄λ‹Ή μ΅°ν•© μ¤ν‚µ
- **2λ‹¨κ³„ νƒμƒ‰**: Coarse β†’ FineμΌλ΅ κ³„μ‚° ν¨μ¨ κ·Ήλ€ν™”

### π”§ reverse_analyzer.py

#### μ£Όμ” ν•¨μ
```python
def reverse_analysis(
    midi_data,    # μ›λ³Έ MIDI λ°”μ΄νΈ
    engine,       # AegisEngine μΈμ¤ν„΄μ¤
    sample_rate=44100
) -> dict
```

#### λ°ν™κ°’
```python
{
    'original_notes': 245,           # μ›λ³Έ λ…ΈνΈ μ
    'reversed_notes': 238,           # μ—­λ³€ν™ λ…ΈνΈ μ
    'note_accuracy': 0.943,          # λ…ΈνΈ μΌμΉμ¨
    'pitch_accuracy': 0.968,         # ν”ΌμΉ μ •ν™•λ„
    'timing_accuracy': 0.892,        # νƒ€μ΄λ° μ •ν™•λ„
    'reversed_midi': b'MThd...',     # μ—­λ³€ν™ MIDI λ°”μ΄νΈ
    'reversed_events': [...]         # μ—­λ³€ν™ μ΄λ²¤νΈ λ¦¬μ¤νΈ
}
```

#### λ§¤μΉ­ μ•κ³ λ¦¬μ¦
```python
for μ›λ³Έ_λ…ΈνΈ in μ›λ³Έ_MIDI:
    μµμ _λ§¤μΉ­ = None
    μµμ†_κ±°λ¦¬ = β

    for μ—­λ³€ν™_λ…ΈνΈ in μ—­λ³€ν™_MIDI:
        ν”ΌμΉ_μ°¨μ΄ = |μ›λ³Έ.ν”ΌμΉ - μ—­λ³€ν™.ν”ΌμΉ|
        μ‹κ°„_μ°¨μ΄ = |μ›λ³Έ.μ‹μ‘μ‹κ°„ - μ—­λ³€ν™.μ‹μ‘μ‹κ°„|

        κ±°λ¦¬ = (ν”ΌμΉ_μ°¨μ΄ / 12) + μ‹κ°„_μ°¨μ΄

        if κ±°λ¦¬ < μµμ†_κ±°λ¦¬:
            μµμ†_κ±°λ¦¬ = κ±°λ¦¬
            μµμ _λ§¤μΉ­ = μ—­λ³€ν™_λ…ΈνΈ

    if ν”ΌμΉ_μ°¨μ΄ β‰¤ 1λ°μ and μ‹κ°„_μ°¨μ΄ β‰¤ 0.1μ΄:
        λ§¤μΉ­_μ„±κ³µ += 1
```

### π“ μ„±λ¥ λ²¤μΉλ§ν¬

#### Auto Match (30μ΄ μμ› κΈ°μ¤€)
- **Coarse Search**: ~15μ΄ (27κ° μ΅°ν•©)
- **Fine Search**: ~15μ΄ (27κ° μ΅°ν•©)
- **μ΄ μ†μ” μ‹κ°„**: ~30μ΄

#### Reverse Analysis
- **MIDI β†’ WAV ν•©μ„±**: ~2μ΄
- **WAV β†’ MIDI λ³€ν™**: ~10μ΄
- **λΉ„κµ λ¶„μ„**: ~1μ΄
- **μ΄ μ†μ” μ‹κ°„**: ~13μ΄

### π§ ν…μ¤νΈ λ°©λ²•

```bash
# λ¨λ“ μ„ν¬νΈ ν…μ¤νΈ
python3 test_new_features.py

# Streamlit UI ν…μ¤νΈ
streamlit run aegis_tuner_pro.py
```

---

## π“ κ³ κΈ‰ ν™μ©

### μ‹λ‚λ¦¬μ¤ 1: μµκ³  ν’μ§ MIDI μƒμ„±
```
1. Auto Matchλ΅ μµμ κ°’ νƒμƒ‰
2. μ—­λ³€ν™ λ¶„μ„μΌλ΅ μ •ν™•λ„ ν™•μΈ
3. μ •ν™•λ„ 90% λ―Έλ§μ΄λ©΄ νλΌλ―Έν„° μλ™ λ―Έμ„Έμ΅°μ •
4. λ‹¤μ‹ μ—­λ³€ν™ λ¶„μ„μΌλ΅ κ²€μ¦
5. λ§μ΅±μ¤λ¬μ΄ κ²°κ³Ό μ–»μ„ λ•κΉμ§€ λ°λ³µ
```

### μ‹λ‚λ¦¬μ¤ 2: λ‹¤μ–‘ν• μ•…κΈ° λΉ„κµ
```
1. κΈ°νƒ€ ν”„λ¦¬μ…‹ λ³€κ²½ (Clean Electric, Jazz, Distortion λ“±)
2. κ° ν”„λ¦¬μ…‹λ³„λ΅ μ—­λ³€ν™ λ¶„μ„ μ‹¤ν–‰
3. κ°€μ¥ λ†’μ€ μ •ν™•λ„μ ν”„λ¦¬μ…‹ μ„ νƒ
4. Auto Matchλ΅ νλΌλ―Έν„° μµμ ν™”
```

### μ‹λ‚λ¦¬μ¤ 3: νλΌλ―Έν„° μν–¥ λ¶„μ„
```
1. Confidenceλ§ 0.2 β†’ 0.8λ΅ λ³€κ²½
2. κ° κ°’λ§λ‹¤ μ—­λ³€ν™ λ¶„μ„
3. μ •ν™•λ„ λ³€ν™” μ¶”μ΄ κ΄€μ°°
4. λ‹¤λ¥Έ νλΌλ―Έν„°λ„ λ™μΌν•κ² λ¶„μ„
5. κ° νλΌλ―Έν„°μ μν–¥λ„ νμ•…
```

---

## π› λ¬Έμ  ν•΄κ²°

### Q: Auto Matchκ°€ μ‹¤ν¨ν•©λ‹λ‹¤
**A:** λ‹¤μμ„ ν™•μΈν•μ„Έμ”:
- FluidSynth μ„¤μΉ μ—¬λ¶€: `brew install fluid-synth`
- μμ› κΈΈμ΄κ°€ 30μ΄ μ΄ν•μΈμ§€ ν™•μΈ
- μμ›μ— μ‹¤μ  μ•…κΈ° μ†λ¦¬κ°€ ν¬ν•¨λμ–΄ μλ”μ§€ ν™•μΈ

### Q: μ—­λ³€ν™ λ¶„μ„ μ •ν™•λ„κ°€ λ„λ¬΄ λ‚®μµλ‹λ‹¤
**A:** κ°€λ¥ν• μ›μΈ:
- μμ›μ— λ°°κ²½ λ…Έμ΄μ¦κ°€ λ§μ β†’ Stem Separation μ‚¬μ©
- ν™”μμ΄ λ§μ€ λ³µμ΅ν• μμ› β†’ λ‹¨μΌ μ•…κΈ° νΈλ™μΌλ΅ μ‹λ„
- νλΌλ―Έν„°κ°€ λ¶€μ μ ν•¨ β†’ Auto Match λ¨Όμ € μ‹¤ν–‰

### Q: νƒμƒ‰ μ‹κ°„μ΄ λ„λ¬΄ κΉλ‹λ‹¤
**A:** μµμ ν™” λ°©λ²•:
- μμ›μ„ 15~20μ΄λ΅ μ§§κ² νΈμ§‘
- λ¶ν•„μ”ν• μ•± μΆ…λ£λ΅ CPU ν™•λ³΄
- νƒμƒ‰ λ²”μ„λ¥Ό μ½”λ“μ—μ„ μλ™ μ΅°μ • (κ³ κΈ‰)

---

## π“ μ°Έκ³  μλ£

### κ΄€λ ¨ νμΌ
- `/Users/mac/.gemini/antigravity/scratch/aegis_engine/aegis_engine_core/auto_matcher.py`
- `/Users/mac/.gemini/antigravity/scratch/aegis_engine/aegis_engine_core/reverse_analyzer.py`
- `/Users/mac/.gemini/antigravity/scratch/aegis_engine/aegis_tuner_pro.py`

### μμ΅΄μ„±
- `librosa`: μ¤λ””μ¤ λ¶„μ„ λ° μ μ‚¬λ„ κ³„μ‚°
- `mido`: MIDI νμΌ νμ‹±
- `numpy`: μμΉ κ³„μ‚°
- `FluidSynth`: MIDI β†’ WAV ν•©μ„± (μ™Έλ¶€ ν”„λ΅κ·Έλ¨)

---

**μ‘μ„±μΌ**: 2026-02-06
**λ²„μ „**: 1.0.0
**μ‘μ„±μ**: Aegis Engine Development Team
